# Шаг 1: Worker + Redis

## Настроить worker поток, который берёт IP из ip_queue через Redis

## Использовать tcp_connect_timeout() для проверки соединения

## Сохранять метрики в Redis: alive/await_list + hash с RTT/throughput/last_checked

# Шаг 2: Мониторинг alive

# Периодически (каждые N секунд) проверять сервера из alive

## Если соединение упало или скорость сильно упала → переместить в await_list

## Если сервер в alive ок → обновить метрики

# Шаг 3: Повторная проверка await_list

Берём сервер из await_list, проверяем снова через tcp_connect_timeout()

Если стал рабочим → перемещаем в alive

Если не стал — оставляем в await_list с увеличенным интервалом (backoff)

Шаг 4: Парсер IP

Можно запускать как отдельный поток/процесс

Парсит сайты или статические файлы с IP

Добавляет новые IP в ip_queue через Redis

Шаг 5: Короткий throughput-тест

После успешного подключения worker может замерять скорость передачи

Можно просто слать/принимать N байт и вычислять kbps

Это позволит сортировать alive по скорости

Шаг 6: Логирование и graceful shutdown

Логи: кто подключился, какой RTT/throughput, кто ушёл в await_list

Обработка SIGINT/SIGTERM для корректного закрытия потоков и Redis

3. Приоритетная реализация

Сделать tcp_connect_timeout() (уже почти готово)

Реализовать worker поток, который берёт IP из Redis и проверяет соединение

Сохранять результат в alive/await_list + hash метрик

Реализовать мониторинг alive и повторную проверку await_list

Подключить парсер новых IP

Добавить throughput-тест и сортировку по скорости

Логирование и graceful shutdown